# Power Monitor üîå

–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –≤ Telegram.

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

–°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –¥–≤–æ—Ö —Ä–æ—É—Ç–µ—Ä—ñ–≤:
1. **–†–æ—É—Ç–µ—Ä 1** ‚Äî –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –ø—Ä–∞—Ü—é—î –≤—ñ–¥ –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞
2. **–†–æ—É—Ç–µ—Ä 2** ‚Äî –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –∑–∞ –¥—Ä—É–≥–∏–º —Ä–æ—É—Ç–µ—Ä–æ–º, –ø—Ä–∞—Ü—é—î –≤—ñ–¥ –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂—ñ, –¥–æ—Å—Ç—É–ø–Ω–∏–π —á–µ—Ä–µ–∑ –ø—Ä–æ–±—Ä–æ—à–µ–Ω–∏–π –ø–æ—Ä—Ç

### –õ–æ–≥—ñ–∫–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç–∞–Ω—É

| –†–æ—É—Ç–µ—Ä 1 (ping) | –†–æ—É—Ç–µ—Ä 2 (port) | –°—Ç–∞–Ω |
|-----------------|-----------------|------|
| ‚úÖ | ‚úÖ | üü¢ –°–≤—ñ—Ç–ª–æ —î |
| ‚úÖ | ‚ùå | üî¥ –°–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞—î |
| ‚ùå | - | üü° –ü—Ä–æ–±–ª–µ–º–∏ –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º |

## –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- ‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–º—ñ–Ω—É —Å—Ç–∞–Ω—É –≤ Telegram
- ‚úÖ –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è—Ö
- ‚úÖ –©–æ–¥–µ–Ω–Ω—ñ —Ç–∞ —â–æ—Ç–∏–∂–Ω–µ–≤—ñ –∑–≤—ñ—Ç–∏ –∑—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º—ñ–∂ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- ‚úÖ –†–æ—Ç–∞—Ü—ñ—è –ª–æ–≥—ñ–≤
- ‚úÖ Graceful shutdown (SIGTERM/SIGINT)
- ‚úÖ Debounce –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è —Ö–∏–±–Ω–∏—Ö —Å–ø—Ä–∞—Ü—é–≤–∞–Ω—å
- ‚úÖ Retry –∑ exponential backoff –¥–ª—è Telegram

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 1. –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```bash
pip install python-telegram-bot
```

### 2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–æ—Ç–∞

1. –ù–∞–ø–∏—à—ñ—Ç—å [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ—é `/newbot`
3. –ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–∞–Ω–∞–ª—É/—á–∞—Ç—É

- –î–ª—è –∫–∞–Ω–∞–ª—É: –¥–æ–¥–∞–π—Ç–µ –±–æ—Ç–∞ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `@channel_name`
- –î–ª—è –≥—Ä—É–ø–∏: –¥–æ–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø—É, –æ—Ç—Ä–∏–º–∞–π—Ç–µ chat_id —á–µ—Ä–µ–∑ API
- –î–ª—è –æ—Å–æ–±–∏—Å—Ç–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: –Ω–∞–ø–∏—à—ñ—Ç—å –±–æ—Ç—É, –æ—Ç—Ä–∏–º–∞–π—Ç–µ –≤–∞—à chat_id

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

–í—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞–ª–∞—à—Ç–æ–≤—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:

| –ó–º—ñ–Ω–Ω–∞ | –û–ø–∏—Å | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º |
|--------|------|------------------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | ‚ùå –û–±–æ–≤'—è–∑–∫–æ–≤–æ |
| `TELEGRAM_CHAT_ID` | ID —á–∞—Ç—É/–∫–∞–Ω–∞–ª—É | ‚ùå –û–±–æ–≤'—è–∑–∫–æ–≤–æ |
| `ROUTER_IP` | IP –ø–µ—Ä—à–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞ | ‚ùå –û–±–æ–≤'—è–∑–∫–æ–≤–æ |
| `ROUTER_2_PORT` | –ü–æ—Ä—Ç –¥—Ä—É–≥–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞ | ‚ùå –û–±–æ–≤'—è–∑–∫–æ–≤–æ |
| `CHECK_INTERVAL` | –Ü–Ω—Ç–µ—Ä–≤–∞–ª –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (—Å–µ–∫) | `10` |
| `PING_TIMEOUT` | –¢–∞–π–º–∞—É—Ç ping (—Å–µ–∫) | `2` |
| `DEBOUNCE_COUNT` | –ö-—Å—Ç—å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—å –¥–ª—è –∑–º—ñ–Ω–∏ —Å—Ç–∞–Ω—É | `6` |
| `REPORT_HOUR` | –ì–æ–¥–∏–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–≤—ñ—Ç—ñ–≤ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 0:00-24:00) | `7` |
| `LOG_FILE` | –®–ª—è—Ö –¥–æ –ª–æ–≥-—Ñ–∞–π–ª—É | `/opt/folder-monitor/power_monitor.log` |
| `LOG_MAX_BYTES` | –ú–∞–∫—Å. —Ä–æ–∑–º—ñ—Ä –ª–æ–≥-—Ñ–∞–π–ª—É | `5242880` (5MB) |
| `LOG_BACKUP_COUNT` | –ö-—Å—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–∏—Ö –ª–æ–≥—ñ–≤ | `3` |
| `STATS_FILE` | –®–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ | `/opt/folder-monitor/power_monitor_stats.json` |
| `TELEGRAM_RETRIES` | –ö-—Å—Ç—å —Å–ø—Ä–æ–± –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è | `3` |
| `STATS_SAVE_INTERVAL` | –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–∂–Ω—ñ N —ñ—Ç–µ—Ä–∞—Ü—ñ–π | `6` |

## –ó–∞–ø—É—Å–∫

### –ù–∞–ø—Ä—è–º—É

```bash
export TELEGRAM_BOT_TOKEN="your-bot-token"
export TELEGRAM_CHAT_ID="@your-telegram-chat-id"
export ROUTER_IP="1.2.3.4"
export ROUTER_2_PORT="1234"
python power_monitor.py
```

### –ß–µ—Ä–µ–∑ systemd

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `/etc/systemd/system/power-monitor.service`:

```ini
[Unit]
Description=Power Monitor
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/folder-monitor
Environment="TELEGRAM_BOT_TOKEN=your-bot-token"
Environment="TELEGRAM_CHAT_ID=@your-telegram-chat-id"
Environment="ROUTER_IP=1.2.3.4"
Environment="ROUTER_2_PORT=1234"

ExecStart=/usr/bin/python3 /opt/folder-monitor/power_monitor.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable power-monitor
sudo systemctl start power-monitor
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É

```bash
sudo systemctl status power-monitor
sudo journalctl -u power-monitor -f
```

## –ü—Ä–∏–∫–ª–∞–¥–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

### –ó–º—ñ–Ω–∞ —Å—Ç–∞–Ω—É

```
üü¢ –°–≤—ñ—Ç–ª–æ –∑ º—è–≤–∏–ª–æ—Å—å
‚è± –°–≤—ñ—Ç–ª–∞ –Ω–µ –±—É–ª–æ: 2–≥ 15—Ö–≤ 30—Å
```

```
üî¥ –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ
‚è± –°–≤—ñ—Ç–ª–æ –±—É–ª–æ: 5–≥ 42—Ö–≤ 18—Å
```

```
üåê –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –≤—ñ–¥–Ω–æ–≤–∏–≤—Å—è
‚è± –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É –Ω–µ –±—É–ª–æ: 10—Ö–≤ 15—Å
```

```
‚òÅÔ∏è –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –ø—Ä–æ–ø–∞–≤ (—Å–≤—ñ—Ç–ª–æ —î)
‚è± –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –±—É–≤: 3–≥ 20—Ö–≤ 0—Å
```

### –©–æ–¥–µ–Ω–Ω–∏–π/—â–æ—Ç–∏–∂–Ω–µ–≤–∏–π –∑–≤—ñ—Ç

```
üìä –©–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç
üìÖ 28.12 ‚Äî 29.12

üí° –°–≤—ñ—Ç–ª–æ: 18–≥ 45—Ö–≤ 12—Å (78.1%)
üîå –ë–µ–∑ —Å–≤—ñ—Ç–ª–∞: 5–≥ 14—Ö–≤ 48—Å (21.9%)
üìà –£–≤—ñ–º–∫–Ω–µ–Ω—å: 3

üåê –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç: 23–≥ 58—Ö–≤ 0—Å (99.9%)
‚òÅÔ∏è –ë–µ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É: 2—Ö–≤ 0—Å (0.1%)
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
/opt/folder-monitor/
‚îú‚îÄ‚îÄ power_monitor.py             # –û—Å–Ω–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ power_monitor.log            # –õ–æ–≥-—Ñ–∞–π–ª (–∑ —Ä–æ—Ç–∞—Ü—ñ—î—é)
‚îú‚îÄ‚îÄ power_monitor.log.1          # –†–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è –ª–æ–≥—É
‚îî‚îÄ‚îÄ power_monitor_stats.json     # –ó–±–µ—Ä–µ–∂–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

## Debounce –ª–æ–≥—ñ–∫–∞

–©–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ö–∏–±–Ω–∏—Ö —Å–ø—Ä–∞—Ü—é–≤–∞–Ω—å —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω—ñ –∑–±–æ—ó –º–µ—Ä–µ–∂—ñ:

- –°—Ç–∞–Ω –∑–º—ñ–Ω—é—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è `DEBOUNCE_COUNT` –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏—Ö –æ–¥–Ω–∞–∫–æ–≤–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
- –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 6 –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ √ó 10 —Å–µ–∫ = **60 —Å–µ–∫—É–Ω–¥** —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É

## –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∫–æ–∂–Ω—É —Ö–≤–∏–ª–∏–Ω—É (~6 —ñ—Ç–µ—Ä–∞—Ü—ñ–π)
- –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ø—Ä–∏ graceful shutdown
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
- –ê—Ç–æ–º–∞—Ä–Ω–∏–π –∑–∞–ø–∏—Å (—á–µ—Ä–µ–∑ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª) –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è

## –ó–≤—ñ—Ç–∏

### –©–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç
- **–ü–µ—Ä—ñ–æ–¥:** 0:00 ‚Äî 24:00 (—Ä—ñ–≤–Ω–æ –¥–æ–±–∞)
- **–°–∫–∏–¥–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:** –æ–ø—ñ–≤–Ω–æ—á—ñ (0:00)
- **–í—ñ–¥–ø—Ä–∞–≤–∫–∞:** –æ `REPORT_HOUR` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 7:00)

### –©–æ—Ç–∏–∂–Ω–µ–≤–∏–π –∑–≤—ñ—Ç
- **–ü–µ—Ä—ñ–æ–¥:** –ø–æ–Ω–µ–¥—ñ–ª–æ–∫ 0:00 ‚Äî –Ω–µ–¥—ñ–ª—è 24:00 (—Ä—ñ–≤–Ω–æ —Ç–∏–∂–¥–µ–Ω—å)
- **–°–∫–∏–¥–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:** –ø–æ–Ω–µ–¥—ñ–ª–æ–∫ –æ 0:00
- **–í—ñ–¥–ø—Ä–∞–≤–∫–∞:** –ø–æ–Ω–µ–¥—ñ–ª–æ–∫ –æ `REPORT_HOUR`

## Troubleshooting

### –ë–æ—Ç –Ω–µ –Ω–∞–¥—Å–∏–ª–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –±–æ—Ç –¥–æ–¥–∞–Ω–∏–π –≤ –∫–∞–Ω–∞–ª/–≥—Ä—É–ø—É —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ chat_id (–¥–ª—è –∫–∞–Ω–∞–ª—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `@channel_name`)

### –ß–∞—Å—Ç—ñ —Ö–∏–±–Ω—ñ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è

–ó–±—ñ–ª—å—à—ñ—Ç—å `DEBOUNCE_COUNT` –∞–±–æ `CHECK_INTERVAL`:

```bash
export DEBOUNCE_COUNT=10
export CHECK_INTERVAL=15
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤

```bash
tail -f /opt/folder-monitor/power_monitor.log
```
